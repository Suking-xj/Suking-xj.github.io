import{aj as e,dW as n,dX as t,dY as a,z as i,bX as o,cq as s,co as l,az as r,ce as c,dZ as x}from"./vendor.d5722712.js";const u=5e-4,p=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return!(e.equals(n)||t)};async function m(){if(n()||!t())return null;await a()}function f(e,t,a){if(!p(e.spatialReference,t))return null;if(!n())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");return a?x(t,e.spatialReference,e):x(e.spatialReference,t,e)}function h(e,t,a,r=null){if(e.spatialReference.equals(t))return e;const c=p(e.spatialReference,t);if(c&&!n())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");const x=a.center,u=new o({xmin:x.x-e.x/2,xmax:x.x+e.x/2,ymin:x.y-e.y/2,ymax:x.y+e.y/2,spatialReference:e.spatialReference}),m=c?s(u,t,r):l(u,t);return null==m?null:{x:m.xmax-m.xmin,y:m.ymax-m.ymin}}function y(e,n=.01){return c(e)?n/c(e):0}function M(e,t,a=null,o=!0){const c=e.spatialReference;if(c.equals(t))return e;const x=p(c,t);if(x&&!n())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");const m=x?s(e,t,a):l(e,t);if(m&&o&&t.isGeographic){var f,h;const[n,t]=c.isWebMercator?r(c).origin:null!=(f=null==(h=r(c))?void 0:h.valid)?f:[],a=y(c);a&&null!=n&&null!=t&&(Math.abs(e.x-n)<a&&Math.abs(180-m.x)<u?m.x-=360:Math.abs(e.x-t)<a&&Math.abs(180+m.x)<u&&(m.x+=360))}return m}function w(t,a,o=null,c=!0){var x,m,f,h;const w=t.spatialReference;if(w.equals(a))return t;const d=p(w,a);if(d&&!n())throw new i("rasterprojectionhelper-projectExtent","projection engine is not loaded");const R=d?s(t,a,o):l(t,a);let[g,b]=null!=(x=null==(m=r(w))?void 0:m.origin)?x:[];if(R&&c&&w.isWebMercator&&a.isGeographic&&null!=g&&null!=b){const n=.001,i=1e3;if(Math.abs(t.xmin-g)<n&&Math.abs(b-t.xmax)>i&&Math.abs(180-R.xmax)<u){R.xmin=-180;const n=[];n.push(new e(t.xmax,t.ymin,w)),n.push(new e(t.xmax,(t.ymin+t.ymax)/2,w)),n.push(new e(t.xmax,t.ymax,w));const i=n.map((e=>M(e,a,o))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));R.xmax=Math.max.apply(null,i)}if(Math.abs(t.xmax-b)<n&&Math.abs(g-t.xmin)>i&&Math.abs(180+R.xmin)<u){R.xmax=180;const n=[];n.push(new e(t.xmin,t.ymin,w)),n.push(new e(t.xmin,(t.ymin+t.ymax)/2,w)),n.push(new e(t.xmin,t.ymax,w));const i=n.map((e=>M(e,a,o))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));R.xmin=Math.min.apply(null,i)}}[g,b]=a.isWebMercator?r(a).origin:null!=(f=null==(h=r(a))?void 0:h.valid)?f:[];const j=y(a);return j&&null!=g&&null!=b&&(Math.abs(R.xmin-g)<j&&(R.xmin=g),Math.abs(R.xmax-b)<j&&(R.xmax=b)),R}function d(t,a,o,s=null,l=null,c=!1,x=[32,32]){var u,m;if(p(t.spatialReference,a.spatialReference)&&!n())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(t&&a&&o))return null;const{xmin:f,ymin:h,xmax:y,ymax:w}=t,d=t.spatialReference,R=a.spatialReference,[g,b]=null!=(u=null==(m=r(d))?void 0:m.valid)?u:[],j={x:x[0]*o.x,y:x[1]*o.y},v={cols:Math.ceil((y-f)/j.x-.1)+1,rows:Math.ceil((w-h)/j.y-.1)+1},N=j.x,S=j.y,z=[];let W,G=!1;for(let n=0;n<v.cols;n++){const t=[];for(let i=0;i<v.rows;i++){let o=M(new e({x:f+N*n,y:w-S*i,spatialReference:d}),R,s);l&&(o=l.inverseTransform(o)),t.push(o),n>0&&c&&o&&W[i]&&null!=g&&o.x<W[i].x&&(o.x+=b-g),o?(z.push((o.x-a.xmin)/(a.xmax-a.xmin)),z.push((a.ymax-o.y)/(a.ymax-a.ymin))):(z.push(NaN),z.push(NaN),G=!0)}W=t}const q=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,a=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return[Math.abs(t-e[2*n.rows+2]),Math.abs(a-e[2*n.rows+3])]}(z,v),L=new Float32Array((v.cols-1)*(v.rows-1)*2*6),P=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),A=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<v.cols-1;e++){for(let n=0;n<v.rows-1;n++){let t=e*v.rows*2+2*n;const a=z[t],i=z[t+1],o=z[t+2],s=z[t+3];t+=2*v.rows;const l=z[t],r=z[t+1],c=z[t+2],x=z[t+3];let u=0,p=12*(n*(v.cols-1)+e);for(let e=0;e<3;e++)L[p++]=P[u++]*a+P[u++]*o+P[u++]*c;u=0;for(let e=0;e<3;e++)L[p++]=P[u++]*i+P[u++]*s+P[u++]*x;u=0;for(let e=0;e<3;e++)L[p++]=A[u++]*a+A[u++]*l+A[u++]*c;u=0;for(let e=0;e<3;e++)L[p++]=A[u++]*i+A[u++]*r+A[u++]*x}if(G)for(let e=0;e<L.length;e++)isNaN(L[e])&&(L[e]=-1)}return{offsets:z,error:q,coefficients:L,spacing:x,size:[v.cols-1,v.rows-1]}}function R(n,t,a){const i=Math.log(n.x/t.pixelSize.x)/Math.LN2,o=Math.log(n.y/t.pixelSize.y)/Math.LN2,s=t.storageInfo.maximumPyramidLevel||0;let l="down"===a?Math.floor(Math.min(i,o)):"up"===a?Math.ceil(Math.max(i,o)):Math.round((i+o)/2),r=!1;l<0?l=0:l>s&&(r=l>s+3,l=s);const c=2**l;return{pyramidLevel:l,pyramidResolution:new e({x:c*t.nativePixelSize.x,y:c*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:r}}function g(n,t,a=512,i=!0){const{extent:o,spatialReference:s,pixelSize:l}=n,r=h(new e({x:l.x,y:l.y,spatialReference:s}),t,o);if(null==r)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const x=(r.x+r.y)/2,u=c(t),p=x*u*96*39.37,m=t.isGeographic?512/a*295828763.7958547:512/a*591657527.591555;let f=!1;const y=w(o,t);i&&(t.isGeographic||t.isWebMercator)&&(f=y.xmin*y.xmax<0);let M,d=p;const R=1.001;if(f){d=m;const n=.29858214164761665,t=n*(96*u*39.37);M=h(new e({x:n,y:n,spatialReference:{wkid:3857}}),s,y),M.x*=d/t,M.y*=d/t}else{M={x:l.x,y:l.y};const e=Math.ceil(Math.log(Math.min(n.width,n.height)/32)/Math.LN2);let t=0;for(;d<m*(R/2)&&t<e;)t++,d*=2,M.x*=2,M.y*=2;Math.max(d,m)/Math.min(d,m)<=R&&(d=m)}const g=[d],b=[{x:M.x,y:M.y}],j=Math.min(70.5310735,p)/R;for(;d>=j;)d/=2,M.x/=2,M.y/=2,g.push(d),b.push({x:M.x,y:M.y});return{projectedPixelSize:r,scales:g,srcResolutions:b,isCustomTilingScheme:!f}}export{h as M,d as R,g as b,M as d,w as g,m as h,R as j,f as y};
