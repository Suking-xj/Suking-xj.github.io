var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&o(e,t,a[t]);return e},r=(e,l)=>a(e,t(l));import{a9 as c,gF as u,gG as m,gH as p,aa as h,gI as d,gJ as f,cR as y,gK as v,e8 as b}from"./vendor.74d5941c.js";const g="picture-fill",w=120,M=document.createElement("canvas");function x(e,a){var t,l;const n=null!=(null==a?void 0:a.size)?c(a.size):null,s=null!=(null==a?void 0:a.maxSize)?c(a.maxSize):null,o=null!=(null==a?void 0:a.opacity)?a.opacity:null,x=null!=(null==a?void 0:a.rotation)?a.rotation:"angle"in e?e.angle:null,k=u(e);let L=m(e);if(k&&!L){const e="type"in k?null:new y(k);"#ffffff"===(e?e.toHex():null)&&(L={color:"#bdc3c7",width:.75})}const j={shape:null,fill:null,stroke:L,offset:[0,0]};null!=(t=L)&&t.width&&(L.width=Math.min(L.width,80));const z=(null==(l=L)?void 0:l.width)||0;let O=null!=n&&(null==(null==a?void 0:a.scale)||(null==a?void 0:a.scale)),P=0,C=0,F=!1;switch(e.type){case"simple-marker":{const a=e.style,t=Math.min(null!=n?n:c(e.size),s||w);switch(P=t,C=t,a){case"circle":j.shape={type:"circle",cx:0,cy:0,r:.5*t},O||(P+=z,C+=z);break;case"cross":j.shape={type:"path",path:[{command:"M",values:[0,.5*C]},{command:"L",values:[P,.5*C]},{command:"M",values:[.5*P,0]},{command:"L",values:[.5*P,C]}]};break;case"diamond":j.shape={type:"path",path:[{command:"M",values:[0,.5*C]},{command:"L",values:[.5*P,0]},{command:"L",values:[P,.5*C]},{command:"L",values:[.5*P,C]},{command:"Z",values:[]}]},O||(P+=z,C+=z);break;case"square":j.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[P,0]},{command:"L",values:[P,C]},{command:"L",values:[0,C]},{command:"Z",values:[]}]},O||(P+=z,C+=z),x&&(F=!0);break;case"triangle":j.shape={type:"path",path:[{command:"M",values:[.5*P,0]},{command:"L",values:[P,C]},{command:"L",values:[0,C]},{command:"Z",values:[]}]},O||(P+=z,C+=z),x&&(F=!0);break;case"x":j.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[P,C]},{command:"M",values:[P,0]},{command:"L",values:[0,C]}]},x&&(F=!0);break;case"path":j.shape={type:"path",path:e.path||""},O||(P+=z,C+=z),x&&(F=!0),O=!0}break}case"simple-line":{const e=Math.min(null!=n?n:z,s||80),a=e>22?2*e:40;L.width=e,P=a,C=e,j.shape={type:"path",path:[{command:"M",values:[0,C]},{command:"L",values:[P,C]}]};break}case g:case"simple-fill":P=Math.min(null!=n?n:22,s||w)+z,C=P,O=!0,j.shape="object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.isSquareFill?p.squareFill[0]:p.fill[0];break;case"picture-marker":{let a=c(e.width),t=c(e.height);const l=Math.max(a,t),o=a/t;a=o<=1?Math.ceil(l*o):l,t=o<=1?l:Math.ceil(l/o),P=Math.min(null!=n?n:a,s||w),C=Math.min(null!=n?n:t,s||w),j.shape={type:"image",x:-Math.round(P/2),y:-Math.round(C/2),width:P,height:C,src:e.url||""},x&&(F=!0);break}case"text":{const a=e,t=a.text||"Aa",l=a.font,o=Math.min(null!=n?n:c(l.size),s||w),i=function(e,a){const t=M.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}(t,{weight:l.weight,size:o,family:l.family}),r=/[\uE600-\uE6FF]/.test(t);P=r?o:i,C=o;let u=.25*function(e){if(0===e.length)return 0;if(e.length>2){const a=b(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}((l?o:0).toString());r&&(u+=5),j.shape={type:"text",text:t,x:0,y:u,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},j.font=l&&{size:o,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!j.shape)return Promise.reject(new h("symbolPreview: renderPreviewHTML2D","symbol not supported."));const S=k,E=e.color;let q=null;return S&&"pattern"===S.type&&E&&e.type!==g?q=v(S.src,E.toCss(!0)).then((e=>(S.src=e,j.fill=S,j))):(j.fill=k,q=Promise.resolve(j)),q.then((e=>{const t=[[e]];if("object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const a=.6*P;t.unshift([r(i({},e),{offset:[-a,0],fill:d(k,-.3)})]),t.push([r(i({},e),{offset:[a,0],fill:d(k,.3)})]),P+=2*a}return f(t,[P,C],{node:a&&a.node,scale:O,opacity:o,rotation:x,useRotationSize:F})}))}export{x as previewSymbol2D};
