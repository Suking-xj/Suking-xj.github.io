import{fL as e,fi as t,fM as n,b3 as r,fN as o,dl as a,aj as c,b4 as i,cw as l,cv as s,bX as u}from"./vendor.d5722712.js";import{h as f,d as h,N as p,a as d,D as g,o as E,J as y,I as m,B as w,S as v,b as N,c as I,T as b,e as S,_ as T,j as R,t as O,u as U,f as A,m as C,p as x,A as M,g as F,O as D,K as P,Z as L,F as k,E as _,i as j,k as V,l as B,w as Y,v as G,X as z,q as H,y as q,P as Z,n as W,s as X,r as K,x as J,z as Q,C as $}from"./arcadeUtils.399e4e8c.js";import{registerFunctions as ee}from"./geomasync.31420ab9.js";import"./number.ad6bfcf0.js";import"./FeatureSetReader.0caf98f1.js";import"./centroid.93c1b848.js";import"./geometryEngineAsync.d51d66e2.js";function te(e){return e instanceof Error?n(e):n(new Error(e))}function ne(e){return o(e)}function re(e,n){const r=[];for(let t=0;t<n.arguments.length;t++)r.push(ce(e,n.arguments[t]));return t(r)}function oe(t,n,r){return e(((e,o)=>{re(t,n).then((a=>{try{e(r(t,n,a))}catch(c){o(c)}}),o)}))}function ae(e,t,n){try{return re(e,t).then((r=>{try{const a=n(e,t,r);return function(e){return e&&"function"==typeof e.then}(a)?a:o(a)}catch(a){return te(a)}}))}catch(r){return te(r)}}function ce(r,c,i){try{if(c.breakpoint&&!0!==i)return c.breakpoint().then((()=>ce(r,c,!0)));switch(c.type){case"VariableDeclarator":return function(t,n){try{let r=null;return r=null===n.init?o(null):ce(t,n.init),null!==t.localScope?r.then((r=>e((e=>{if(r===S&&(r=null),"Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const o=n.id.name.toLowerCase();t.localScope[o]={value:r,valueset:!0,node:n.init},e(S)})))):r.then((r=>e((e=>{if("Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const o=n.id.name.toLowerCase();r===S&&(r=null),t.globalScope[o]={value:r,valueset:!0,node:n.init},e(S)}))))}catch(r){return te(r)}}(r,c);case"VariableDeclaration":return ge(r,c,0);case"BlockStatement":return function(e,t){try{return de(e,t,0)}catch(i){return te(i)}}(r,c);case"FunctionDeclaration":return function(e,t){try{const n=t.id.name.toLowerCase();return e.globalScope[n]={valueset:!0,node:null,value:new O(t,e)},o(S)}catch(i){return te(i)}}(r,c);case"ReturnStatement":return function(t,n){return e(((e,r)=>{null===n.argument?e(new I(S)):ce(t,n.argument).then((t=>{try{e(new I(t))}catch(n){r(n)}}),r)}))}(r,c);case"IfStatement":return function(t,n){return e(((e,r)=>{"AssignmentExpression"!==n.test.type&&"UpdateExpression"!==n.test.type?ce(t,n.test).then((o=>{try{!0===o?ce(t,n.consequent).then(e,r):!1===o?null!==n.alternate?ce(t,n.alternate).then(e,r):e(S):r(new Error(F(n.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(a){r(a)}}),r):r(new Error(F(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(r,c);case"ExpressionStatement":return function(t,r){try{return"AssignmentExpression"===r.expression.type?ce(t,r.expression):(r.expression.type,ce(t,r.expression).then((t=>e((e=>{e(t===S?S:new b(t))})))))}catch(o){return n(o)}}(r,c);case"UpdateExpression":return function(t,r){try{const n=r.argument;if("MemberExpression"===n.type){const a={t:null};return ce(t,n.object).then((e=>{let r=null;return a.t=e,!0===n.computed?r=ce(t,n.property):"Identifier"===n.property.type&&(r=o(n.property.name)),r})).then((t=>e((e=>{const n=a.t;let o;if(L(n)){if(!Y(t))throw new Error("Invalid Parameter");if(t<0&&(t=n.length+t),t<0||t>=n.length)throw new Error("Assignment outside of array bounds");o=z(n[t]),n[t]="++"===r.operator?o+1:o-1}else if(n instanceof j){if(!1===k(t))throw new Error("Dictionary accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");o=z(n.field(t)),n.setField(t,"++"===r.operator?o+1:o-1)}else{if(!(n instanceof V))throw _(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===k(t))throw new Error("Feature accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");o=z(n.field(t)),n.setField(t,"++"===r.operator?o+1:o-1)}!1===r.prefix?e(o):e("++"===r.operator?o+1:o-1)}))))}return e(((e,n)=>{const o="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!o)throw new Error("Invalid identifier");let a;return null!==t.localScope&&void 0!==t.localScope[o]?(a=z(t.localScope[o].value),t.localScope[o]={value:"++"===r.operator?a+1:a-1,valueset:!0,node:r},void(!1===r.prefix?e(a):e("++"===r.operator?a+1:a-1))):void 0!==t.globalScope[o]?(a=z(t.globalScope[o].value),t.globalScope[o]={value:"++"===r.operator?a+1:a-1,valueset:!0,node:r},void(!1===r.prefix?e(a):e("++"===r.operator?a+1:a-1))):void n(new Error("Variable not recognised"))}))}catch(a){return n(a)}}(r,c);case"AssignmentExpression":return function(t,n){return e(((e,r)=>{const a=n.left;if("MemberExpression"===a.type)ce(t,n.right).then((c=>{try{ce(t,a.object).then((i=>{try{let l=null;if(!0===a.computed)l=ce(t,a.property);else{if("Identifier"!==a.property.type)throw new Error("Expected computed or identifier for assignemnt target");l=o(a.property.name)}l.then((t=>{try{if(L(i)){if(!Y(t))throw new Error("Invalid Parameter");if(t<0&&(t=i.length+t),t<0||t>i.length)throw new Error("Assignment outside of array bounds");if(t===i.length){if("="!==n.operator)throw new Error("Invalid Parameter");i[t]=pe(c,n.operator,i[t],n)}else i[t]=pe(c,n.operator,i[t],n)}else if(i instanceof j){if(!1===k(t))throw new Error("Dictionary accessor must be a string");if(!0===i.hasField(t))i.setField(t,pe(c,n.operator,i.field(t),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");i.setField(t,pe(c,n.operator,null,n))}}else{if(!(i instanceof V))throw _(i)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===k(t))throw new Error("Feature accessor must be a string");if(!0===i.hasField(t))i.setField(t,pe(c,n.operator,i.field(t),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");i.setField(t,pe(c,n.operator,null,n))}}e(S)}catch(o){r(o)}}),r)}catch(l){r(l)}}),r)}catch(i){r(i)}}),r);else{const o=a.name.toLowerCase();if(null!==t.localScope&&void 0!==t.localScope[o])return void ce(t,n.right).then((a=>{try{t.localScope[o]={value:pe(a,n.operator,t.localScope[o].value,n),valueset:!0,node:n.right},e(S)}catch(c){r(c)}}),r);void 0!==t.globalScope[o]?ce(t,n.right).then((a=>{try{t.globalScope[o]={value:pe(a,n.operator,t.globalScope[o].value,n),valueset:!0,node:n.right},e(S)}catch(c){r(c)}}),r):r(new Error("Cannot assign undeclared variable"))}}))}(r,c);case"ForStatement":return function(t,r){try{return null!==r.init?ce(t,r.init).then((()=>e(((e,n)=>{le(t,r,{testResult:!0,lastAction:S},(t=>{e(t)}),(e=>{n(e)}),0)})))):e(((e,n)=>{le(t,r,{testResult:!0,lastAction:S},(t=>{e(t)}),(e=>{n(e)}),0)}))}catch(o){return n(o)}}(r,c);case"ForInStatement":return function(t,n){return e(((e,r)=>{ce(t,n.right).then((a=>{try{let c=null;c="VariableDeclaration"===n.left.type?ce(t,n.left):o(),c.then((()=>{try{let o="";if("VariableDeclaration"===n.left.type){const e=n.left.declarations[0].id;"Identifier"===e.type&&(o=e.name)}else"Identifier"===n.left.type&&(o=n.left.name);if(!o)throw new Error(F(n,"RUNTIME","INVALIDVARIABLE"));o=o.toLowerCase();let i=null;if(null!==t.localScope&&void 0!==t.localScope[o]&&(i=t.localScope[o]),null===i&&void 0!==t.globalScope[o]&&(i=t.globalScope[o]),null===i)return void r(new Error(F(n,"RUNTIME","VARIABLENOTDECLARED")));L(a)||k(a)?fe(t,n,a,{reject:r,resolve:e},i):_(a)?function(e,t,n,r,o,a){try{if(void 0===a&&(a="i"),0===n.length)return void r.resolve(S);ue(e,t,n,o,0,a,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(c){r.reject(c)}}(t,n,a,{reject:r,resolve:e},i):a instanceof j||a instanceof V?function(e,t,n,r,o){try{fe(e,t,n.keys(),r,o,"k")}catch(a){r.reject(a)}}(t,n,a,{reject:r,resolve:e},i):B(a)?he(a.iterator(t.abortSignal),t,n,a,i,(t=>{e(t)}),(e=>{r(e)}),0):fe(t,n,[],{reject:r,resolve:e},i)}catch(o){r(o)}}),r)}catch(c){r(c)}}),r)}))}(r,c);case"BreakStatement":return o(T);case"EmptyStatement":return o(S);case"ContinueStatement":return o(R);case"TemplateElement":return function(e,t){return o(t.value?t.value.cooked:"")}(0,c);case"TemplateLiteral":return function(t,n){return e((e=>{const r=[];D(n.expressions,((e,n,o,a)=>ce(t,n).then((e=>{r[o]=P(e)})))).then((()=>{let t="",o=0;for(const e of n.quasis)t+=e.value?e.value.cooked:"",!1===e.tail&&(t+=r[o]?r[o]:"",o++);e(t)}))}))}(r,c);case"Identifier":return me(r,c);case"MemberExpression":return function(t,r){try{return ce(t,r.object).then((c=>{try{return null===c?n(new Error(F(r,"RUNTIME","NOTFOUND"))):!1===r.computed?"Identifier"===r.property.type?c instanceof j||c instanceof V?o(c.field(r.property.name)):c instanceof a?o(ye(c,r.property.name,t,r)):n(new Error(F(r,"RUNTIME","INVALIDTYPE"))):n(new Error(F(r,"RUNTIME","INVALIDTYPE"))):ce(t,r.property).then((n=>e(((e,o)=>{if(c instanceof j||c instanceof V)k(n)?e(c.field(n)):o(new Error(F(r,"RUNTIME","INVALIDTYPE")));else if(c instanceof a)k(n)?e(ye(c,n,t,r)):o(new Error(F(r,"RUNTIME","INVALIDTYPE")));else if(L(c))if(Y(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length+n),n>=c.length||n<0)throw new Error(F(r,"RUNTIME","OUTOFBOUNDS"));e(c[n])}else o(new Error(F(r,"RUNTIME","INVALIDTYPE")));else if(_(c))if(Y(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length()+n),n>=c.length()||n<0)throw new Error(F(r,"RUNTIME","OUTOFBOUNDS"));e(c.get(n))}else o(new Error(F(r,"RUNTIME","INVALIDTYPE")));else if(k(c))if(Y(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length+n),n>=c.length||n<0)throw new Error(F(r,"RUNTIME","OUTOFBOUNDS"));e(c[n])}else o(new Error(F(r,"RUNTIME","INVALIDTYPE")));else o(new Error(F(r,"RUNTIME","INVALIDTYPE")))}))))}catch(i){return te(i)}}))}catch(c){return te(c)}}(r,c);case"Literal":return ne(c.value);case"CallExpression":return function(e,t){try{if("Identifier"!==t.callee.type)return te(F(t,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[t.callee.name.toLowerCase()]){const n=e.localScope[t.callee.name.toLowerCase()];return n.value instanceof v?n.value.fn(e,t):n.value instanceof O?Oe(e,t,n.value.definition):te(F(t,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[t.callee.name.toLowerCase()]){const n=e.globalScope[t.callee.name.toLowerCase()];return n.value instanceof v?n.value.fn(e,t):n.value instanceof O?Oe(e,t,n.value.definition):te(F(t,"RUNTIME","NOTAFUNCTION"))}return te(F(t,"RUNTIME","NOTFOUND"))}catch(i){return te(i)}}(r,c);case"UnaryExpression":return function(t,n){try{return ce(t,n.argument).then((t=>e(((e,r)=>{m(t)&&"!"===n.operator?e(!t):"-"===n.operator?e(-1*z(t)):"+"===n.operator?e(1*z(t)):"~"===n.operator?e(~z(t)):r(new Error(F(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))))}catch(r){return te(r)}}(r,c);case"BinaryExpression":return function(n,r){try{return t([ce(n,r.left),ce(n,r.right)]).then((t=>e(((e,n)=>{const o=t[0],a=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":e(q(z(o),z(a),r.operator));case"==":e(w(o,a));break;case"!=":e(!w(o,a));break;case"<":case">":case"<=":case">=":e(H(o,a,r.operator));break;case"+":k(o)||k(a)?e(P(o)+P(a)):e(z(o)+z(a));break;case"-":e(z(o)-z(a));break;case"*":e(z(o)*z(a));break;case"/":e(z(o)/z(a));break;case"%":e(z(o)%z(a));break;default:n(new Error(F(r,"RUNTIME","OPERATORNOTRECOGNISED")))}}))))}catch(o){return te(o)}}(r,c);case"LogicalExpression":return function(t,n){return e(((e,r)=>{"AssignmentExpression"!==n.left.type&&"UpdateExpression"!==n.left.type?"AssignmentExpression"!==n.right.type&&"UpdateExpression"!==n.right.type?ce(t,n.left).then((o=>{try{if(!m(o))throw new Error(F(n,"RUNTIME","ONLYBOOLEAN"));switch(n.operator){case"||":!0===o?e(o):ce(t,n.right).then((t=>{try{if(!m(t))throw new Error(F(n,"RUNTIME","ONLYORORAND"));e(t)}catch(o){r(o)}}),r);break;case"&&":!1===o?e(o):ce(t,n.right).then((t=>{try{if(!m(t))throw new Error(F(n,"RUNTIME","ONLYORORAND"));e(t)}catch(o){r(o)}}),r);break;default:throw new Error(F(n,"RUNTIME","ONLYORORAND"))}}catch(a){r(a)}}),r):r(new Error(F(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):r(new Error(F(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(r,c);case"ConditionalExpression":return te(F(c,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(n,r){try{const o=[];for(let e=0;e<r.elements.length;e++)o.push(ce(n,r.elements[e]));return t(o).then((t=>e(((e,n)=>{for(let o=0;o<t.length;o++){if(G(t[o]))return void n(new Error(F(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));t[o]===S&&(t[o]=null)}e(t)}))))}catch(o){return te(o)}}(r,c);case"ObjectExpression":return function(n,r){try{const o=[];for(let e=0;e<r.properties.length;e++)o.push(ce(n,r.properties[e]));return t(o).then((t=>e((e=>{const n={};for(let o=0;o<t.length;o++){const e=t[o];if(G(e.value))throw new Error("Illegal Argument");if(!1===k(e.key))throw new Error("Illegal Argument");e.value===S?n[e.key.toString()]=null:n[e.key.toString()]=e.value}const r=new j(n);r.immutable=!1,e(r)}))))}catch(o){return te(o)}}(r,c);case"Property":return function(t,r){try{return ce(t,r.value).then((n=>e((e=>{"Identifier"===r.key.type?e({key:r.key.name,value:n}):ce(t,r.key).then((t=>{e({key:t,value:n})}))}))))}catch(o){return n(o)}}(r,c);default:return te(F(c,"RUNTIME","UNREOGNISED"))}}catch(l){return te(l)}}function ie(e,t,r){try{return ce(e,t.body).then((a=>{try{return r.lastAction=a,r.lastAction===T||r.lastAction instanceof I?(r.testResult=!1,o(r)):null!==t.update?ce(e,t.update).then((()=>o(r))):o(r)}catch(c){return n(c)}}))}catch(a){return n(a)}}function le(e,t,r,a,c,i){try{(function(e,t,r){try{return null!==t.test?ce(e,t.test).then((a=>{try{return!0===e.abortSignal.aborted?n(new Error("Cancelled")):(r.testResult=a,!1===r.testResult?o(r):!0!==r.testResult?n(new Error(F(t,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):ie(e,t,r))}catch(c){return n(c)}})):ie(e,t,r)}catch(i){return n(i)}})(e,t,r).then((()=>{try{!0===r.testResult?++i>100?(i=0,setTimeout((()=>{le(e,t,r,a,c,i)}),0)):le(e,t,r,a,c,i):r.lastAction instanceof I?a(r.lastAction):a(S)}catch(n){c(n)}}),(e=>{c(e)}))}catch(l){c(l)}}function se(e,t,n,r,o,a,c,i,l,s){try{if(r<=a)return void i(S);o.value="k"===c?n[a]:a,ce(e,t.body).then((u=>{try{u instanceof I?i(u):u===T?i(S):++s>100?(s=0,setTimeout((()=>{se(e,t,n,r,o,a+1,c,i,l,s)}),0)):se(e,t,n,r,o,a+1,c,i,l,s)}catch(f){l(f)}}),(e=>{l(e)}))}catch(u){l(u)}}function ue(e,t,n,r,o,a,c,i,l){try{if(n.length()<=o)return void c(S);r.value="k"===a?n.get(o):o,ce(e,t.body).then((s=>{s instanceof I?c(s):s===T?c(S):++l>100?(l=0,setTimeout((()=>{ue(e,t,n,r,o+1,a,c,i,l)}),0)):ue(e,t,n,r,o+1,a,c,i,l)}),(e=>{i(e)}))}catch(s){i(s)}}function fe(e,t,n,r,o,a){try{if(void 0===a&&(a="i"),0===n.length)return void r.resolve(S);se(e,t,n,n.length,o,0,a,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(c){r.reject(c)}}function he(e,t,n,r,o,a,c,i){try{e.next().then((l=>{try{if(null===l)a(S);else{const s=V.createFromGraphicLikeObject(l.geometry,l.attributes,r);s._underlyingGraphic=l,o.value=s,ce(t,n.body).then((l=>{try{l===T?a(S):l instanceof I?a(l):++i>100?(i=0,setTimeout((()=>{he(e,t,n,r,o,a,c,i)}),0)):he(e,t,n,r,o,a,c,i)}catch(s){c(s)}}),(e=>{c(e)}))}}catch(s){c(s)}}),(e=>{c(e)}))}catch(l){c(l)}}function pe(e,t,n,r){switch(t){case"=":return e===S?null:e;case"/=":return z(n)/z(e);case"*=":return z(n)*z(e);case"-=":return z(n)-z(e);case"+=":return k(n)||k(e)?P(n)+P(e):z(n)+z(e);case"%=":return z(n)%z(e);default:throw new Error(F(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}function de(t,n,r){try{return r>=n.body.length?o(S):e(((e,o)=>{ce(t,n.body[r]).then((a=>{try{a instanceof I||a===T||a===R||r===n.body.length-1?e(a):de(t,n,r+1).then(e,o)}catch(c){o(c)}}),o)}))}catch(a){return te(a)}}function ge(t,n,r){return e(((e,o)=>{r>=n.declarations.length?e(S):ce(t,n.declarations[r]).then((()=>{r===n.declarations.length-1?e(S):ge(t,n,r+1).then((()=>{e(S)}),o)}),o)}))}let Ee=0;function ye(e,t,n,r){let o;switch(t=t.toLowerCase()){case"hasz":{const t=e.hasZ;return void 0!==t&&t}case"hasm":{const t=e.hasM;return void 0!==t&&t}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let n=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(n=!1),n&&(Ee++,e.spatialReference._arcadeCacheId=Ee,t=Ee)}const n=new j({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const n=e[t];return void 0!==n?n:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return o=e.cache._arcadeCacheId,void 0===o&&(Ee++,o=Ee,e.cache._arcadeCacheId=o),new $(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==e[t]?e[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return o=e.cache._arcadeCacheId,void 0===o&&(Ee++,o=Ee,e.cache._arcadeCacheId=o),new $(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return o=e.cache._arcadeCacheId,void 0===o&&(Ee++,o=Ee,e.cache._arcadeCacheId=o),new Q(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,o,1);case"type":return"Multipoint"}}throw new Error(F(r,"RUNTIME","PROPERTYNOTFOUND"))}function me(t,n){return e(((e,r)=>{const o=n.name.toLowerCase();if(null===t.localScope||void 0===t.localScope[o])if(void 0===t.globalScope[o])r(new Error(F(n,"RUNTIME","VARIABLENOTFOUND")));else{const n=t.globalScope[o];!0===n.valueset?e(n.value):null!==n.d?n.d.then(e,r):(n.d=ce(t,n.node),n.d.then((t=>{try{n.value=t,n.valueset=!0,e(t)}catch(o){r(o)}}),r))}else{const n=t.localScope[o];!0===n.valueset?e(n.value):null!==n.d?n.d.then(e,r):(n.d=ce(t,n.node),n.d.then((t=>{try{n.value=t,n.valueset=!0,e(t)}catch(o){r(o)}}),r))}}))}const we={};function ve(e){return null===e?"":L(e)||_(e)?"Array":Z(e)?"Date":k(e)?"String":m(e)?"Boolean":Y(e)?"Number":e instanceof W?"Attachment":e instanceof X?"Portal":e instanceof j?"Dictionary":e instanceof V?"Feature":e instanceof c?"Point":e instanceof i?"Polygon":e instanceof l?"Polyline":e instanceof s?"Multipoint":e instanceof u?"Extent":G(e)?"Function":B(e)?"FeatureSet":K(e)?"FeatureSetCollection":e===S?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function Ne(t,n,r,o){return e(((e,a)=>{ce(t,n.arguments[r]).then((c=>{try{if(w(c,o))return void ce(t,n.arguments[r+1]).then(e,a);{const c=n.arguments.length-r;return 1===c?void ce(t,n.arguments[r]).then(e,a):(2===c&&e(null),3===c?void ce(t,n.arguments[r+2]).then(e,a):void Ne(t,n,r+2,o).then(e,a))}}catch(i){a(i)}}),a)}))}function Ie(t,n,r,o){return e(((e,a)=>{!0===o?ce(t,n.arguments[r+1]).then(e,a):n.arguments.length-r==3?ce(t,n.arguments[r+2]).then(e,a):ce(t,n.arguments[r+2]).then((o=>{try{if(!1===m(o))return void a(new Error("WHEN needs boolean test conditions"));Ie(t,n,r+2,o).then(e,a)}catch(c){a(c)}}))}))}function be(n,r){try{const a=n.length,c=Math.floor(a/2);return 0===a?o([]):1===a?o([n[0]]):e(((e,o)=>{const i=[be(n.slice(0,c),r),be(n.slice(c,a),r)];t(i).then((t=>{try{Se(t[0],t[1],r,[]).then(e,o)}catch(n){o(n)}}),o)}))}catch(a){return te(a)}}function Se(t,n,r,o){return e(((e,a)=>{const c=o;t.length>0||n.length>0?t.length>0&&n.length>0?r(t[0],n[0]).then((i=>{try{isNaN(i)&&(i=1),i<=0?(c.push(t[0]),t=t.slice(1)):(c.push(n[0]),n=n.slice(1)),Se(t,n,r,o).then(e,a)}catch(l){a(l)}}),a):t.length>0?(c.push(t[0]),Se(t=t.slice(1),n,r,o).then(e,a)):n.length>0&&(c.push(n[0]),n=n.slice(1),Se(t,n,r,o).then(e,a)):e(o)}))}function Te(e,t){const n=e.length,r=Math.floor(n/2);return t||(t=function(e,t){return e<t?-1:e===t?0:1}),0===n?[]:1===n?[e[0]]:function(e,t,n){const r=[];for(;e.length>0||t.length>0;)if(e.length>0&&t.length>0){let o=n(e[0],t[0]);isNaN(o)&&(o=1),o<=0?(r.push(e[0]),e=e.slice(1)):(r.push(t[0]),t=t.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):t.length>0&&(r.push(t[0]),t=t.slice(1));return r}(Te(e.slice(0,r),t),Te(e.slice(r,n),t),t)}function Re(t,r,o){try{const n=t.body;if(o.length!==t.params.length)return te(new Error("Invalid Parameter calls to function."));for(let e=0;e<o.length;e++){const n=t.params[e];"Identifier"===n.type&&(r.localScope[n.name.toLowerCase()]={d:null,value:o[e],valueset:!0,node:null})}return ce(r,n).then((t=>e(((e,n)=>{t instanceof I?e(t.value):t!==T?t!==R?e(t instanceof b?t.value:t):n(new Error("Cannot Continue from a Function")):n(new Error("Cannot Break from a Function"))}))))}catch(a){return n(a)}}function Oe(e,t,n){return ae(e,t,(function(t,r,o){const a={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return Re(n,a,o)}))}function Ue(e){return function(){const t={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(t.depthCounter>64)throw new Error("Exceeded maximum function depth");return Re(e.definition,t,arguments)}}f(we,oe),h(we,oe),p(we,oe),d(we,oe),g(we,oe),E(we,oe),ee({functions:we,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:oe,standardFunctionAsync:ae}),we.typeof=function(e,t){return oe(e,t,(function(e,t,n){y(n,1,1);const r=ve(n[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r}))},we.iif=function(n,r){return e(((e,o)=>{y(null===r.arguments?[]:r.arguments,3,3),ce(n,r.arguments[0]).then((a=>{try{if(!1===m(a))return void o(new Error("IF Function must have a boolean test condition"));t([ce(n,r.arguments[1]),ce(n,r.arguments[2])]).then((t=>{e(a?t[0]:t[1])}),o)}catch(c){o(c)}}),o)}))},we.decode=function(t,n){return e(((e,r)=>{n.arguments.length<2?r(new Error("Missing Parameters")):2!==n.arguments.length?(n.arguments.length-1)%2!=0?ce(t,n.arguments[0]).then((o=>{try{Ne(t,n,1,o).then(e,r)}catch(a){r(a)}}),r):r(new Error("Must have a default value result.")):ce(t,n.arguments[1]).then(e,r)}))},we.when=function(t,n){try{return n.arguments.length<3?te("Missing Parameters"):n.arguments.length%2==0?te("Must have a default value result."):ce(t,n.arguments[0]).then((r=>e(((e,o)=>{!1!==m(r)?Ie(t,n,0,r).then(e,o):o(new Error("WHEN needs boolean test conditions"))}))))}catch(r){return te(r)}},we.sort=function(e,t){return ae(e,t,(function(e,t,n){y(n,1,2);let r=n[0];if(_(r)&&(r=r.toArray()),!1===L(r))return te(Error("Illegal Argument"));if(n.length>1)return!1===G(n[1])?te(Error("Illegal Argument")):be(r,Ue(n[1]));{let e=r;if(0===e.length)return o([]);const t={};for(let r=0;r<e.length;r++){const n=ve(e[r]);""!==n&&(t[n]=!0)}if(!0===t.Array||!0===t.Dictionary||!0===t.Feature||!0===t.Point||!0===t.Polygon||!0===t.Polyline||!0===t.Multipoint||!0===t.Extent||!0===t.Function)return o(e.slice(0));let n=0,a="";for(const r in t)n++,a=r;return n>1||"String"===a?e=Te(e,(function(e,t){if(null==e||e===S)return null==t||t===S?0:1;if(null==t||t===S)return-1;const n=P(e),r=P(t);return n<r?-1:n===r?0:1})):"Number"===a?e=Te(e,(function(e,t){return e-t})):"Boolean"===a?e=Te(e,(function(e,t){return e===t?0:t?-1:1})):"Date"===a&&(e=Te(e,(function(e,t){return t-e}))),o(e)}}))};const Ae={failDefferred:te,resolveDeffered:ne,fixSpatialReference:J,parseArguments:re,standardFunction:oe,standardFunctionAsync:ae,evaluateIdentifier:me,arcadeCustomFunction:Ue};for(const Ve in we)we[Ve]={value:new v(we[Ve]),valueset:!0,node:null};const Ce=function(){};function xe(e){console.log(e)}(Ce.prototype=we).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Ce.prototype.pi={value:Math.PI,valueset:!0,node:null};const Me=Ae;function Fe(e){const t={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:oe,standardFunctionAsync:ae,failDefferred:te,evaluateIdentifier:me,arcadeCustomFunctionHandler:Ue};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(const n in t.functions)we[n]={value:new v(t.functions[n]),valueset:!0,node:null},Ce.prototype[n]=we[n];for(let n=0;n<t.signatures.length;n++)N(t.signatures[n],"async")}function De(t,n){let o=n.spatialReference;null==o&&(o=new r({wkid:102100}));const a=function(e,t){const n=new Ce;null==e&&(e={}),null==t&&(t={});const r=new j({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});r.immutable=!1,n.textformatting={value:r,valueset:!0,node:null};for(const o in t)n[o]={value:new v(t[o]),native:!0,valueset:!0,node:null};for(const o in e)e[o]&&"esri.Graphic"===e[o].declaredClass?n[o]={value:V.createFromGraphic(e[o]),valueset:!0,node:null}:n[o]={value:e[o],valueset:!0,node:null};return n}(n.vars,n.customfunctions);return ce({spatialReference:o,services:n.services,abortSignal:void 0===n.abortSignal||null===n.abortSignal?{aborted:!1}:n.abortSignal,globalScope:a,console:n.console?n.console:xe,lrucache:n.lrucache,interceptor:n.interceptor,localScope:null,depthCounter:1},t.body[0].body).then((t=>e(((e,n)=>{t instanceof I&&(t=t.value),t instanceof b&&(t=t.value),t===S&&(t=null),t!==T?t!==R?t instanceof v||t instanceof O?n(new Error("Cannot return FUNCTION")):e(t):n(new Error("Cannot return CONTINUE")):n(new Error("Cannot return BREAK"))}))))}function Pe(e,t){return U(e)}function Le(e,t){return A(e,t,"full")}function ke(e,t){return C(e,t)}function _e(e,t){return x(e,t)}function je(e){return M(e)}export{De as executeScript,Fe as extend,Pe as extractFieldLiterals,je as findFunctionCalls,Me as functionHelper,_e as referencesFunction,ke as referencesMember,Le as validateScript};
