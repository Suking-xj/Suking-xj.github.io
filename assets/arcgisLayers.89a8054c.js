var e=Object.defineProperty,r=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(r,a,t)=>a in r?e(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,o=(e,r)=>{for(var a in r||(r={}))l.call(r,a)&&s(e,a,r[a]);if(t)for(var a of t(r))n.call(r,a)&&s(e,a,r[a]);return e},u=(e,t)=>r(e,a(t));import{dM as i,a0 as y,aa as c,dN as d,a5 as f,dO as p,dD as b,aj as I}from"./vendor.74d5941c.js";import{a as v}from"./lazyLayerLoader.9af2c0cd.js";async function S(e){var r;const a=null==(r=e.properties)?void 0:r.customParameters,t=await async function(e,r){let a=i(e);if(y(a)&&(a=await async function(e,r){const a=await O(e,r);let t=null,l=null;const n=a.type;if("Feature Layer"===n||"Table"===n?(t="FeatureServer",l=a.id):"indexedVector"===n?t="VectorTileServer":a.hasOwnProperty("mapName")?t="MapServer":a.hasOwnProperty("bandCount")&&a.hasOwnProperty("pixelSizeX")?t="ImageServer":a.hasOwnProperty("maxRecordCount")&&a.hasOwnProperty("allowGeometryUpdates")?t="FeatureServer":a.hasOwnProperty("streamUrls")&&(t="StreamServer"),!t)return null;const s=null!=l?d(e):null;return{title:f(s)&&a.name||p(e),serverType:t,sublayer:l,url:{path:f(s)?s.serviceUrl:b(e).path}}}(e,r)),y(a))throw new c("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:t,sublayer:l}=a;let n;const s={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(t){case"MapServer":n=null!=l?"FeatureLayer":async function(e,r){return(await O(e,r)).tileInfo}(e,r).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":n=O(e,r).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||"LERC"!==r.toUpperCase()||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":n=O(a.url.path,r).then((e=>{const r={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const a=e.layers[0].layerType;if(null!=r[a])return r[a]}return"SceneLayer"}));break;default:n=s[t]}const o={FeatureLayer:!0,SceneLayer:!0},u="FeatureServer"===t,I={parsedUrl:a,Constructor:null,layerOrTableId:u?l:null,sublayerIds:null,tableIds:null},S=await n;if(o[S]&&null==l){const a=await async function(e,r,a){var t,l;let n,s=!1;if("FeatureServer"===r){const r=await async function(e,r){var a,t;let l=await O(e,r);l=l||{},l.layers=(null==(a=l.layers)?void 0:a.filter(w))||[];const n={serviceJSON:l};if(l.currentVersion<10.5)return n;const s=await O(e+"/layers",r);return n.layersJSON={layers:(null==s||null==(t=s.layers)?void 0:t.filter(w))||[],tables:(null==s?void 0:s.tables)||[]},n}(e,a);s=!!r.layersJSON,n=r.layersJSON||r.serviceJSON}else n=await O(e,a);const o=null==(t=n)?void 0:t.layers,u=null==(l=n)?void 0:l.tables;return{layerIds:(null==o?void 0:o.map((e=>e.id)).reverse())||[],tableIds:(null==u?void 0:u.map((e=>e.id)).reverse())||[],layerInfos:s?o:[],tableInfos:s?u:[]}}(e,t,r);if(u&&(I.sublayerInfos=a.layerInfos,I.tableInfos=a.tableInfos),a.layerIds.length+a.tableIds.length!==1)I.sublayerIds=a.layerIds,I.tableIds=a.tableIds;else if(u){var m,h;I.layerOrTableId=null!=(m=a.layerIds[0])?m:a.tableIds[0],I.sourceJSON=null!=(h=a.layerInfos[0])?h:a.tableInfos[0]}}return I.Constructor=await async function(e){return(0,v[e])()}(S),I}(e.url,a),l=u(o({},e.properties),{url:e.url});if(!t.sublayerIds)return null!=t.layerOrTableId&&(l.layerId=t.layerOrTableId,l.sourceJSON=t.sourceJSON),new t.Constructor(l);const n=new((await import("./GroupLayer.b1aa1d68.js")).default)({title:t.parsedUrl.title});return function(e,r,a){function t(e,t){const l=u(o({},a),{layerId:e,sublayerTitleMode:"service-name"});return f(t)&&(l.sourceJSON=t),new r.Constructor(l)}r.sublayerIds.forEach((a=>{const l=t(a,m(r.sublayerInfos,a));e.add(l)})),r.tableIds.forEach((a=>{const l=t(a,m(r.tableInfos,a));e.tables.add(l)}))}(n,t,l),n}function m(e,r){return e?e.find((e=>e.id===r)):null}function w(e){return!e.type||"Feature Layer"===e.type}async function O(e,r){return(await I(e,{responseType:"json",query:o({f:"json"},r)})).data}export{S as fromUrl};
