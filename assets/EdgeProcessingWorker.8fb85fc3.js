var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,a=(t,e)=>{for(var n in e||(e={}))r.call(e,n)&&i(t,n,e[n]);if(o)for(var n of o(e))s.call(e,n)&&i(t,n,e[n]);return t};import{cj as c,cG as l,fJ as f,fK as u,aP as g,fL as d,fM as p,fN as h,aQ as m,fO as w,fP as v,fQ as y,fR as A,fS as b,fT as I,fU as L}from"./vendor.74d5941c.js";import{A as N,f as S,u as U,a as E,p as V,c as O,o as P,i as x,m as j,T as M,d as D,b as W,l as F,h as k,e as B,O as T,x as z,g as C,w as R,E as q,L as H,F as G,I as Q,U as $,j as J,V as K,M as _,S as X,k as Y,q as Z,v as tt,z as et,B as nt,C as ot,D as rt,G as st,H as it}from"./InterleavedLayout.07204280.js";import"./vec4.44fdb266.js";function at(t,e,n,o){for(let r=0;r<o;r++)if(t[e+r]!==t[n+r])return!1;return!0}function ct(t,e,n,o,r){for(let s=0;s<r;s++)n[o+s]=t[e+s]}function lt(t,e,n){let o=0;for(let r=0;r<n;r++)o=t[e+r]+o|0,o=o+(o<<11)+(o>>>2)|0;return o>>>0}let ft=null;const ut={divisor:0};function gt(t,e={}){e=a(a({},ut),e);const n=t.stride;return t.fieldNames.filter((e=>{const n=t.fields.get(e).optional;return!(n&&n.glPadding)})).map((o=>{const r=t.fields.get(o),s=r.constructor.ElementCount,i=function(t){const e=dt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}(r.constructor.ElementType),a=r.offset,c=!(!r.optional||!r.optional.glNormalized);return{name:o,stride:n,count:s,type:i,offset:a,normalized:c,divisor:e.divisor}}))}const dt={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126},pt=N().vec3f("position").u16("componentIndex").u16("u16padding");gt(N().vec2u8("sideness"));const ht=N().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0}),mt=ht.clone().vec3f("normal"),wt=ht.clone().vec3f("normalA").vec3f("normalB");class vt{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?Lt:It}write(t,e,n){const o=this.edgeHashFunction(n);Vt.seed=o;const r=Vt.getIntRange(0,255),s=Vt.getIntRange(0,this.settings.variants-1),i=Vt.getFloat(),a=255*(.5*function(t,e){const n=t<0?-1:1;return Math.abs(t)**e*n}(-(1-Math.min(i/.7,1))+Math.max(0,i-.7)/(1-.7),1.2)+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,r),t.variantStroke.set(e,s),t.variantExtension.set(e,a)}trim(t,e){return t.slice(0,e)}}const yt=new Float32Array(6),At=new Uint32Array(yt.buffer),bt=new Uint32Array(1);function It(t){const e=yt;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],bt[0]=5381;for(let n=0;n<At.length;n++)bt[0]=31*bt[0]+At[n];return bt[0]}function Lt(t){const e=yt;e[0]=Nt(t.position0[0]),e[1]=Nt(t.position0[1]),e[2]=Nt(t.position0[2]),e[3]=Nt(t.position1[0]),e[4]=Nt(t.position1[1]),e[5]=Nt(t.position1[2]),bt[0]=5381;for(let n=0;n<At.length;n++)bt[0]=31*bt[0]+At[n];return bt[0]}function Nt(t){return Math.round(1e4*t)/1e4}class St{constructor(){this.commonWriter=new vt}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return mt.createBuffer(t)}write(t,e,n){this.commonWriter.write(t,e,n),f(Et,n.faceNormal0,n.faceNormal1),u(Et,Et),t.normal.setVec(e,Et)}trim(t,e){return this.commonWriter.trim(t,e)}}St.Layout=mt,St.glLayout=gt(mt,{divisor:1});class Ut{constructor(){this.commonWriter=new vt}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return wt.createBuffer(t)}write(t,e,n){this.commonWriter.write(t,e,n),t.normalA.setVec(e,n.faceNormal0),t.normalB.setVec(e,n.faceNormal1)}trim(t,e){return this.commonWriter.trim(t,e)}}Ut.Layout=wt,Ut.glLayout=gt(wt,{divisor:1});const Et=g(),Vt=new l;function Ot(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:Pt(t.layout)}}function Pt(t){const o=new Array;return t.fields.forEach(((t,r)=>{const s=(i=a({},t),c={constructor:jt(t.constructor)},e(i,n(c)));var i,c;o.push([r,s])})),{stride:t.stride,fields:o,fieldNames:t.fieldNames}}const xt=[S,U,E,V,O,P,x,j,M,D,W,F,k,B,T,z,C,R,q,H,G,Q,$,J,K,_,X,Y,Z,tt,et,nt,ot,rt,st,it];function jt(t){return`${t.ElementType}_${t.ElementCount}`}const Mt=new Map;function Dt(t,e,n){const o=e/3,r=new Uint32Array(n+1),s=new Uint32Array(n+1),i=(t,e)=>{t<e?r[t+1]++:s[e+1]++};for(let w=0;w<o;w++){const e=t[3*w],n=t[3*w+1],o=t[3*w+2];i(e,n),i(n,o),i(o,e)}let a=0,c=0;for(let w=0;w<n;w++){const t=r[w+1],e=s[w+1];r[w+1]=a,s[w+1]=c,a+=t,c+=e}const l=new Uint32Array(6*o),f=r[n],u=(t,e,n)=>{if(t<e){const o=r[t+1]++;l[2*o]=e,l[2*o+1]=n}else{const o=s[e+1]++;l[2*f+2*o]=t,l[2*f+2*o+1]=n}};for(let w=0;w<o;w++){const e=t[3*w],n=t[3*w+1],o=t[3*w+2];u(e,n,w),u(n,o,w),u(o,e,w)}const g=(t,e)=>{const n=2*t,o=e-t;for(let r=1;r<o;r++){const t=l[n+2*r],e=l[n+2*r+1];let o=r-1;for(;o>=0&&l[n+2*o]>t;o--)l[n+2*o+2]=l[n+2*o],l[n+2*o+3]=l[n+2*o+1];l[n+2*o+2]=t,l[n+2*o+3]=e}};for(let w=0;w<n;w++)g(r[w],r[w+1]),g(f+s[w],f+s[w+1]);const d=new Int32Array(3*o),p=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,h=(t,e)=>{const n=p(t,e);d[3*e+n]=-1},m=(t,e,n,o)=>{const r=p(t,e);d[3*e+r]=o;const s=p(n,o);d[3*o+s]=e};for(let w=0;w<n;w++){let t=r[w];const e=r[w+1];let n=s[w];const o=s[w+1];for(;t<e&&n<o;){const e=l[2*t],o=l[2*f+2*n];e===o?(m(w,l[2*t+1],o,l[2*f+2*n+1]),t++,n++):e<o?(h(w,l[2*t+1]),t++):(h(o,l[2*f+2*n+1]),n++)}for(;t<e;)h(w,l[2*t+1]),t++;for(;n<o;)h(l[2*f+2*n],l[2*f+2*n+1]),n++}return d}xt.forEach((t=>Mt.set(jt(t),t)));const Wt=-1;function Ft(t,e,n,o=Rt){const r=t.vertices.position,s=t.vertices.componentIndex,i=d(o.anglePlanar),a=d(o.angleSignificantEdge),c=Math.cos(a),l=Math.cos(i),f=zt.edge,g=f.position0,A=f.position1,b=f.faceNormal0,N=f.faceNormal1,S=function(t){const e=t.faces.length/3,n=t.vertices.position,o=t.faces,r=Ct.v0,s=Ct.v1,i=Ct.v2,a=new Float32Array(3*e);for(let c=0;c<e;c++){const t=o[3*c+0],e=o[3*c+1],l=o[3*c+2];n.getVec(t,r),n.getVec(e,s),n.getVec(l,i),I(s,s,r),I(i,i,r),y(r,s,i),u(r,r),a[3*c+0]=r[0],a[3*c+1]=r[1],a[3*c+2]=r[2]}return a}(t),U=function(t){const e=t.faces.length/3,n=t.faces,o=t.neighbors;let r=0;for(let a=0;a<e;a++){const t=o[3*a+0],e=o[3*a+1],s=o[3*a+2],i=n[3*a+0],c=n[3*a+1],l=n[3*a+2];r+=t===Wt||i<c?1:0,r+=e===Wt||c<l?1:0,r+=s===Wt||l<i?1:0}const s=new Int32Array(4*r);let i=0;for(let a=0;a<e;a++){const t=o[3*a+0],e=o[3*a+1],r=o[3*a+2],c=n[3*a+0],l=n[3*a+1],f=n[3*a+2];(t===Wt||c<l)&&(s[i++]=c,s[i++]=l,s[i++]=a,s[i++]=t),(e===Wt||l<f)&&(s[i++]=l,s[i++]=f,s[i++]=a,s[i++]=e),(r===Wt||f<c)&&(s[i++]=f,s[i++]=c,s[i++]=a,s[i++]=r)}return s}(t),E=U.length/4,V=e.allocate(E);let O=0;const P=E,x=n.allocate(P);let j=0,M=0,D=0;const W=p(0,E),F=new Float32Array(E);h(F,((t,e,n)=>{r.getVec(U[4*e+0],g),r.getVec(U[4*e+1],A),n[e]=L(g,A)})),W.sort(((t,e)=>F[e]-F[t]));const k=new Array,B=new Array;for(let u=0;u<E;u++){const t=W[u],o=F[t],a=U[4*t+0],d=U[4*t+1],p=U[4*t+2],h=U[4*t+3],y=h===Wt;if(r.getVec(a,g),r.getVec(d,A),y)m(b,S[3*p+0],S[3*p+1],S[3*p+2]),w(N,b),f.componentIndex=s.get(a),f.cosAngle=v(b,N);else{if(m(b,S[3*p+0],S[3*p+1],S[3*p+2]),m(N,S[3*h+0],S[3*h+1],S[3*h+2]),f.componentIndex=s.get(a),f.cosAngle=v(b,N),Bt(f,l))continue;f.cosAngle<-.9999&&w(N,b)}M+=o,D++,y||kt(f,c)?(e.write(V,O++,f),k.push(o)):Tt(f,i)&&(n.write(x,j++,f),B.push(o))}const T=new Float32Array(k.reverse()),z=new Float32Array(B.reverse());return{regular:{instancesData:e.trim(V,O),lodInfo:{lengths:T}},silhouette:{instancesData:n.trim(x,j),lodInfo:{lengths:z}},averageEdgeLength:M/D}}function kt(t,e){return t.cosAngle<e}function Bt(t,e){return t.cosAngle>e}function Tt(t,e){const n=A(t.cosAngle),o=zt.fwd,r=zt.ortho;return b(o,t.position1,t.position0),n*(v(y(r,t.faceNormal0,t.faceNormal1),o)>0?-1:1)>e}const zt={edge:{position0:g(),position1:g(),faceNormal0:g(),faceNormal1:g(),componentIndex:0,cosAngle:0},ortho:g(),fwd:g()},Ct={v0:g(),v1:g(),v2:g()},Rt={anglePlanar:4,angleSignificantEdge:35};async function qt(t){const e=(r=t,{data:pt.createView(r.dataBuffer),indices:"Uint32Array"===r.indicesType?new Uint32Array(r.indicesBuffer):"Uint16Array"===r.indicesType?new Uint16Array(r.indicesBuffer):void 0,indicesLength:r.indicesLength,writerSettings:r.writerSettings,skipDeduplicate:r.skipDeduplicate}),n=Ht(e),o=[e.data.buffer];var r;return{result:Gt(n,o),transferList:o}}function Ht(t){const e=function(t,e,n,o){if(e)return{faces:n,facesLength:o,neighbors:Dt(n,o,t.count),vertices:t};const r=function(t,e,n){var o;const r=t.byteLength/(4*e),s=new Uint32Array(t,0,r*e);let i=new Uint32Array(r);const a=null!=(o=null==n?void 0:n.minReduction)?o:0,l=(null==n?void 0:n.originalIndices)||null,f=l?l.length:0,u=(null==n?void 0:n.componentOffsets)||null;let g=0;if(u)for(let c=0;c<u.length-1;c++){const t=u[c+1]-u[c];t>g&&(g=t)}else g=r;const d=Math.floor(1.1*g)+1;(null==ft||ft.length<2*d)&&(ft=new Uint32Array(c(2*d)));for(let c=0;c<2*d;c++)ft[c]=0;let p=0;const h=!!u&&!!l,m=h?f:r,w=h?new Uint32Array(f):null,v=1.96;let y=0!==a?Math.ceil(7.84*v/(a*a)*a*(1-a)):m,A=1,b=u?u[1]:m;for(let c=0;c<m;c++){if(c===y){const t=1-p/c;if(t+v*Math.sqrt(t*(1-t)/c)<a)return null;y*=2}if(c===b){for(let t=0;t<2*d;t++)ft[t]=0;if(l)for(let t=u[A-1];t<u[A];t++)w[t]=i[l[t]];b=u[++A]}const t=h?l[c]:c,n=t*e,o=lt(s,n,e);let r=o%d,f=p;for(;0!==ft[2*r+1];){if(ft[2*r]===o){const t=ft[2*r+1]-1;if(at(s,n,t*e,e)){f=i[t];break}}r++,r>=d&&(r-=d)}f===p&&(ft[2*r]=o,ft[2*r+1]=t+1,p++),i[t]=f}if(0!==a&&1-p/r<a)return null;if(h){for(let t=u[A-1];t<w.length;t++)w[t]=i[l[t]];i=w}const I=new Uint32Array(e*p);p=0;for(let c=0;c<m;c++)i[c]===p&&(ct(s,(h?l[c]:c)*e,I,p*e,e),p++);if(l&&!h){const t=new Uint32Array(f);for(let e=0;e<t.length;e++)t[e]=i[l[e]];i=t}return{buffer:I.buffer,indices:i,uniqueCount:p}}(t.buffer,t.stride/4,{originalIndices:n,originalIndicesLength:o}),s=Dt(r.indices,o,r.uniqueCount);return{faces:r.indices,facesLength:r.indices.length,neighbors:s,vertices:pt.createView(r.buffer)}}(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Qt.updateSettings(t.writerSettings),$t.updateSettings(t.writerSettings),Ft(e,Qt,$t)}function Gt(t,e){return e.push(t.regular.lodInfo.lengths.buffer),e.push(t.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:Ot(t.regular.instancesData,e),lodInfo:{lengths:t.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:Ot(t.silhouette.instancesData,e),lodInfo:{lengths:t.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:t.averageEdgeLength}}const Qt=new St,$t=new Ut;export{Ht as work,qt as wrappedWork};
