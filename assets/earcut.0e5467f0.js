const e=!0,n=32,t=1.5,x=200;function r(e,n,t){const x=n&&n.length,r=x?n[0]*t:e.length;let l=i(e,0,r,t,!0);const f=new Array;if(!l||l.next===l.prev)return f;let y,p,v,h,d;if(x&&(l=function(e,n,t,x){const r=new Array;for(let u=0,o=n.length;u<o;u++){const t=i(e,n[u]*x,u<o-1?n[u+1]*x:e.length,x,!1);t===t.next&&(t.steiner=!0),r.push(s(t))}r.sort(b);for(const i of r)c(i,t),t=u(t,t.next);return t}(e,n,l,t)),e.length>80*t){y=v=e[0],p=h=e[1];for(let n=t;n<r;n+=t){const t=e[n],x=e[n+1];y=Math.min(y,t),p=Math.min(p,x),v=Math.max(v,t),h=Math.max(h,x)}d=Math.max(v-y,h-p),d=0!==d?1/d:0}return o(l,f,t,y,p,d),f}function i(e,n,t,x,r){let i;if(r===Z(e,n,t,x)>0)for(let u=n;u<t;u+=x)i=y(u,e[u],e[u+1],i);else for(let u=t-x;u>=n;u-=x)i=y(u,e[u],e[u+1],i);return i&&z(i,i.next)&&(p(i),i=i.next),i}function u(e,n=e){if(!e)return e;let t,x=e;do{if(t=!1,x.steiner||!z(x,x.next)&&0!==d(x.prev,x,x.next))x=x.next;else{if(p(x),x=n=x.prev,x===x.next)break;t=!0}}while(t||x!==n);return n}function o(e,n,t,x,r,i,y=0){if(!e)return;!y&&i&&(e=v(e,x,r,i));let s=e;for(;e.prev!==e.next;){const c=e.prev,v=e.next;if(i?f(e,x,r,i):l(e))n.push(c.index/t),n.push(e.index/t),n.push(v.index/t),p(e),e=v.next,s=v.next;else if((e=v)===s){y?1===y?o(e=m(e,n,t),n,t,x,r,i,2):2===y&&k(e,n,t,x,r,i):o(u(e),n,t,x,r,i,1);break}}}function l(e){const n=e.prev,t=e,x=e.next;if(d(n,t,x)>=0)return!1;let r=e.next.next;const i=r;let u=0;for(;r!==e.prev&&(0===u||r!==i);){if(u++,w(n.x,n.y,t.x,t.y,x.x,x.y,r.x,r.y)&&d(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function f(e,n,t,x){const r=e.prev,i=e,u=e.next;if(d(r,i,u)>=0)return!1;const o=r.x<i.x?r.x<u.x?r.x:u.x:i.x<u.x?i.x:u.x,l=r.y<i.y?r.y<u.y?r.y:u.y:i.y<u.y?i.y:u.y,f=r.x>i.x?r.x>u.x?r.x:u.x:i.x>u.x?i.x:u.x,y=r.y>i.y?r.y>u.y?r.y:u.y:i.y>u.y?i.y:u.y,p=M(o,l,n,t,x),s=M(f,y,n,t,x);let c=e.prevZ,v=e.nextZ;for(;c&&c.z>=p&&v&&v.z<=s;){if(c!==e.prev&&c!==e.next&&w(r.x,r.y,i.x,i.y,u.x,u.y,c.x,c.y)&&d(c.prev,c,c.next)>=0)return!1;if(c=c.prevZ,v!==e.prev&&v!==e.next&&w(r.x,r.y,i.x,i.y,u.x,u.y,v.x,v.y)&&d(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;c&&c.z>=p;){if(c!==e.prev&&c!==e.next&&w(r.x,r.y,i.x,i.y,u.x,u.y,c.x,c.y)&&d(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;v&&v.z<=s;){if(v!==e.prev&&v!==e.next&&w(r.x,r.y,i.x,i.y,u.x,u.y,v.x,v.y)&&d(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function y(e,n,t,x){const r=new q(e,n,t);return x?(r.next=x.next,r.prev=x,x.next.prev=r,x.next=r):(r.prev=r,r.next=r),r}function p(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function s(e){let n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function c(e,n){if(n=function(e,n){let t=n;const x=e.x,r=e.y;let i,u=-1/0;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const e=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(e<=x&&e>u){if(u=e,e===x){if(r===t.y)return t;if(r===t.next.y)return t.next}i=t.x<t.next.x?t:t.next}}t=t.next}while(t!==n);if(!i)return null;if(x===u)return i.prev;const o=i,l=i.x,f=i.y;let y,p=1/0;for(t=i.next;t!==o;)x>=t.x&&t.x>=l&&x!==t.x&&w(r<f?x:u,r,l,f,r<f?u:x,r,t.x,t.y)&&(y=Math.abs(r-t.y)/(x-t.x),(y<p||y===p&&t.x>i.x)&&g(t,e)&&(i=t,p=y)),t=t.next;return i}(e,n)){const t=j(n,e);u(t,t.next)}}function v(e,n,t,x){for(let r;r!==e;r=r.next){if(r=r||e,null===r.z&&(r.z=M(r.x,r.y,n,t,x)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,v(e,n,t,x);r.prevZ=r.prev,r.nextZ=r.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let n,t=1;for(;;){let x,r=e;e=null,n=null;let i=0;for(;r;){i++,x=r;let u=0;for(;u<t&&x;u++)x=x.nextZ;let o=t;for(;u>0||o>0&&x;){let t;0===u?(t=x,x=x.nextZ,o--):0!==o&&x?r.z<=x.z?(t=r,r=r.nextZ,u--):(t=x,x=x.nextZ,o--):(t=r,r=r.nextZ,u--),n?n.nextZ=t:e=t,t.prevZ=n,n=t}r=x}if(n.nextZ=null,t*=2,i<2)return e}}(e)}function h(e,n,t,x){const r=n&&n.length,i=r?n[0]*t:e.length;let u=Math.abs(Z(e,0,i,t));if(r)for(let l=0,f=n.length;l<f;l++){const x=n[l]*t,r=l<f-1?n[l+1]*t:e.length;u-=Math.abs(Z(e,x,r,t))}let o=0;for(let l=0;l<x.length;l+=3){const n=x[l]*t,r=x[l+1]*t,i=x[l+2]*t;o+=Math.abs((e[n]-e[i])*(e[r+1]-e[n+1])-(e[n]-e[r])*(e[i+1]-e[n+1]))}return 0===u&&0===o?0:Math.abs((o-u)/u)}function d(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function a(e,n,t,x){return!!(z(e,n)&&z(t,x)||z(e,x)&&z(t,n))||d(e,n,t)>0!=d(e,n,x)>0&&d(t,x,e)>0!=d(t,x,n)>0}function Z(e,n,t,x){let r=0;for(let i=n,u=t-x;i<t;i+=x)r+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return r}function w(e,n,t,x,r,i,u,o){return(r-u)*(n-o)-(e-u)*(i-o)>=0&&(e-u)*(x-o)-(t-u)*(n-o)>=0&&(t-u)*(i-o)-(r-u)*(x-o)>=0}function g(e,n){return d(e.prev,e,e.next)<0?d(e,n,e.next)>=0&&d(e,e.prev,n)>=0:d(e,n,e.prev)<0||d(e,e.next,n)<0}function M(e,n,t,x,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-x)*r)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function z(e,n){return e.x===n.x&&e.y===n.y}function b(e,n){return e.x-n.x}function m(e,n,t){let x=e;do{const r=x.prev,i=x.next.next;!z(r,i)&&a(r,x,x.next,i)&&g(r,i)&&g(i,r)&&(n.push(r.index/t),n.push(x.index/t),n.push(i.index/t),p(x),p(x.next),x=e=i),x=x.next}while(x!==e);return x}function k(e,n,t,x,r,i){let l=e;do{let e=l.next.next;for(;e!==l.prev;){if(l.index!==e.index&&A(l,e)){let f=j(l,e);return l=u(l,l.next),f=u(f,f.next),o(l,n,t,x,r,i),void o(f,n,t,x,r,i)}e=e.next}l=l.next}while(l!==e)}function A(e,n){return e.next.index!==n.index&&e.prev.index!==n.index&&!function(e,n){let t=e;do{if(t.index!==e.index&&t.next.index!==e.index&&t.index!==n.index&&t.next.index!==n.index&&a(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&g(e,n)&&g(n,e)&&function(e,n){let t=e,x=!1;const r=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&r<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(x=!x),t=t.next}while(t!==e);return x}(e,n)}function j(e,n){const t=new q(e.index,e.x,e.y),x=new q(n.index,n.x,n.y),r=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=r,r.prev=t,x.next=t,t.prev=x,i.next=x,x.prev=i,x}class q{constructor(e,n,t){this.index=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}export{r as a,t as c,x as e,e as o,h as s,n as t};
